<div class="manage-product">
  <h2>Manage Products</h2>

  <div style="margin-top:16px; margin-bottom:32px;">
    <h3 style="margin-bottom: 12px;">Category Reference</h3>
    <table class="category-ref-table">
      <thead>
        <tr>
          <th>Category ID</th>
          <th>Category Name</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cat of categories">
          <td>{{ cat.categoryId }}</td>
          <td>{{ cat.categoryName }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <form [formGroup]="productForm" (ngSubmit)="createProduct()">
    <mat-form-field appearance="outline">
      <mat-label>Name</mat-label>
      <input matInput formControlName="name" required />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Description</mat-label>
      <input matInput formControlName="description" required/>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Price</mat-label>
      <input matInput type="number" formControlName="price" required />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Stock Quantity</mat-label>
      <input matInput type="number" formControlName="stockQuantity" required />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Category Name</mat-label>
      <input matInput formControlName="categoryName" required />
    </mat-form-field>
    <button mat-raised-button color="primary" type="submit" [disabled]="productForm.invalid || loading">Add Product</button>
  </form>

  <form [formGroup]="updateForm" (ngSubmit)="updateProduct()" style="margin-top:24px;">
    <mat-form-field appearance="outline">
      <mat-label>Old Product Name</mat-label>
      <input matInput formControlName="oldName" required />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>New Name</mat-label>
      <input matInput formControlName="name" required />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Description</mat-label>
      <input matInput formControlName="description" />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Price</mat-label>
      <input matInput type="number" formControlName="price" required />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Stock Quantity</mat-label>
      <input matInput type="number" formControlName="stockQuantity" required />
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Category Name</mat-label>
      <input matInput formControlName="categoryName" required />
    </mat-form-field>
    <button mat-raised-button color="accent" type="submit" [disabled]="updateForm.invalid || loading">Update Product</button>
  </form>

  <!-- <div style="margin-top:24px;">
    <button mat-stroked-button color="warn" (click)="deleteProduct()" [disabled]="!updateForm.get('oldName')?.value || loading">Delete Product</button>
  </div> -->

  <div style="margin-top:24px;">
    <mat-form-field appearance="outline" style="width: 300px;">
      <mat-label>Product Name to Delete</mat-label>
      <input matInput [(ngModel)]="deleteProductName" name="deleteProductName" required />
    </mat-form-field>
    <button mat-stroked-button color="warn" (click)="deleteProductByName()" [disabled]="!deleteProductName || loading">
      <mat-icon>delete</mat-icon> Delete Product By Name
    </button>
  </div>

  <div *ngIf="message" class="message">{{ message }}</div>

  <div style="margin-top:32px;">
    <h3 style="margin-bottom: 16px;">All Products</h3>
    <div class="product-grid impressive-product-grid responsive-product-grid">
      <mat-card class="product-summary-card impressive-card" *ngFor="let p of products" [class.selected]="selectedProductId === p.productId" (click)="selectedProductId = p.productId"(keydown.enter)="selectedProductId = p.productId" tabindex="0">
        <div class="impressive-card-header">
          <div class="impressive-image-wrapper" *ngIf="p.imageUrl">
            <img [src]="p.imageUrl" alt="{{ p.name }}" class="impressive-product-image" />
          </div>
          <mat-icon class="prod-icon">shopping_bag</mat-icon>
          <span class="prod-title">{{ p.name }}</span>
          <span class="prod-badge impressive-badge">â‚¹{{ p.price }}</span>
        </div>
        <div class="prod-id">ID: {{ p.productId }}</div>
        <div class="prod-meta">Stock: {{ p.stockQuantity }}</div>
        <div class="prod-meta">Category Name: {{ p.categoryName }}</div>
        <div class="prod-desc" *ngIf="p.description">{{ p.description }}</div>
      </mat-card>
    </div>
    <div style="text-align:center; margin-top: 24px;">
      <button mat-stroked-button color="warn" (click)="deleteProduct()" [disabled]="!selectedProductId || loading">
        <mat-icon>delete</mat-icon> Delete Selected Product
      </button>
      <button mat-stroked-button (click)="fetchProducts()" style="margin-left: 16px;">
        <mat-icon>refresh</mat-icon> Refresh List
      </button>
    </div>
  </div>
</div>
